"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8980],{8980:(A,k,a)=>{a.r(k),a.d(k,{StockManagementModule:()=>X});var g=a(2200),l=a(7343),f=a(4341),b=a(8132),M=a(467),_=a(1413),v=a(9584),F=a(3294),x=a(6977),t=a(3664),s=a(2615),I=a(5035),S=a(9330),h=a(8810),p=a(9437),j=a(5312),y=a(8938),P=a(3067);let $=(()=>{var i;class c{constructor(o,e){this.http=o,this.loginService=e,this.API_URL=`${j.c.apiBaseUrl}/stock`}getHeaders(){const o=this.loginService.getToken();return new S.Lr({"Content-Type":"application/json",Authorization:`Bearer ${o}`})}getStocks(o=1,e=y.R.TEN,n){let d=`${this.API_URL}?page=${o}&itemsPerPage=${e}`;return n&&n.trim()&&(d+=`&search=${encodeURIComponent(n.trim())}`),this.http.get(d,{headers:this.getHeaders()}).pipe((0,p.W)(m=>(0,h.$)(()=>m)))}getStock(o){return this.http.get(`${this.API_URL}/${o}`,{headers:this.getHeaders()}).pipe((0,p.W)(e=>(0,h.$)(()=>e)))}createStock(o){return this.http.post(this.API_URL,o,{headers:this.getHeaders()}).pipe((0,p.W)(e=>(0,h.$)(()=>e)))}updateStock(o,e){return this.http.put(`${this.API_URL}/${o}`,e,{headers:this.getHeaders()}).pipe((0,p.W)(n=>(0,h.$)(()=>n)))}deleteStock(o){return this.http.delete(`${this.API_URL}/${o}`,{headers:this.getHeaders()}).pipe((0,p.W)(e=>(0,h.$)(()=>e)))}static#t=i=()=>(this.\u0275fac=function(e){return new(e||c)(s.KVO(S.Qq),s.KVO(P.H))},this.\u0275prov=s.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}))}return i(),c})();var O=a(6568),C=a(385);const B=["searchInput"];function R(i,c){if(1&i&&(t.j41(0,"ion-item",16)(1,"ion-label"),t.EFF(2," Found "),t.j41(3,"strong"),t.EFF(4),t.k0s(),t.EFF(5," stock(s) "),t.k0s()()),2&i){const r=t.XpG();t.R7$(4),t.JRh(r.stocks.length)}}function E(i,c){if(1&i){const r=t.RV6();t.j41(0,"ion-item",18)(1,"ion-label",19),t.bIt("click",function(){const e=s.eBV(r).$implicit,n=t.XpG(2);return s.Njj(n.openReadForm(e))}),t.j41(2,"h2"),t.EFF(3),t.j41(4,"ion-badge",20),t.EFF(5),t.k0s()(),t.j41(6,"p",21),t.EFF(7,"Material: "),t.j41(8,"strong"),t.EFF(9),t.k0s(),t.EFF(10," | Date: "),t.j41(11,"strong"),t.EFF(12),t.nI1(13,"date"),t.k0s()(),t.j41(14,"p",22),t.EFF(15),t.k0s()(),t.j41(16,"ion-buttons",23)(17,"ion-button",24),t.bIt("click",function(){const e=s.eBV(r).$implicit,n=t.XpG(2);return s.Njj(n.openUpdateForm(e))}),t.nrm(18,"ion-icon",25),t.k0s(),t.j41(19,"ion-button",26),t.bIt("click",function(){const e=s.eBV(r).$implicit,n=t.XpG(2);return s.Njj(n.confirmDelete(e))}),t.nrm(20,"ion-icon",27),t.k0s()()()}if(2&i){const r=c.$implicit;t.R7$(3),t.SpI("",r.stockId," "),t.R7$(2),t.SpI("#",r.sellerId),t.R7$(4),t.JRh(r.rawMaterial),t.R7$(3),t.JRh(t.i5U(13,6,r.stockDate,"short")),t.R7$(3),t.Lme("Bars: ",r.noOfBars," | Weight: ",r.weight,"kg")}}function T(i,c){if(1&i&&(t.j41(0,"ion-list"),t.DNE(1,E,21,9,"ion-item",17),t.k0s()),2&i){const r=t.XpG();t.R7$(),t.Y8G("ngForOf",r.stocks)}}function G(i,c){if(1&i&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&i){const r=t.XpG(2);t.R7$(),t.SpI('No stock matches your search "',r.searchQuery,'"')}}function D(i,c){1&i&&(t.j41(0,"p"),t.EFF(1,"No stock available. Click the add button to create one."),t.k0s())}function N(i,c){if(1&i&&(t.j41(0,"ion-card",28)(1,"ion-card-header")(2,"ion-card-title"),t.EFF(3,"No Stock Found"),t.k0s()(),t.j41(4,"ion-card-content"),t.DNE(5,G,2,1,"p",11)(6,D,2,0,"p",11),t.k0s()()),2&i){const r=t.XpG();t.R7$(5),t.Y8G("ngIf",r.searchQuery),t.R7$(),t.Y8G("ngIf",!r.searchQuery&&0===r.stocks.length)}}function U(i,c){if(1&i){const r=t.RV6();t.j41(0,"app-header",30),t.bIt("backClicked",function(){s.eBV(r);const e=t.XpG(2);return s.Njj(e.closeForm())}),t.k0s(),t.j41(1,"ion-content")(2,"p"),t.EFF(3,"Stock Form - To be implemented"),t.k0s()()}if(2&i){const r=t.XpG(2);t.Y8G("title","create"===r.formMode?"Create Stock":"update"===r.formMode?"Update Stock":"Stock Details")("showBackButton",!0)}}function V(i,c){if(1&i){const r=t.RV6();t.j41(0,"ion-modal",29),t.bIt("ionModalDidDismiss",function(){s.eBV(r);const e=t.XpG();return s.Njj(e.closeForm())}),t.DNE(1,U,4,2,"ng-template"),t.k0s()}}let Q=(()=>{var i;class c{constructor(o,e,n,d){this.alertController=o,this.navCtrl=e,this.stockService=n,this.operationsService=d,this.stocks=[],this.formMode=null,this.selectedStock=null,this.showForm=!1,this.currentPage=1,this.hasMore=!0,this.loading=!1,this.searchQuery="",this.searchSubject=new _.B,this.destroy$=new _.B,this.searchSubject.pipe((0,v.B)(300),(0,F.F)(),(0,x.Q)(this.destroy$)).subscribe(m=>{this.performSearch(m)})}ngOnInit(){console.log("Stock Management Component Initialized"),this.loadStocks()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.searchSubject.complete()}loadStocks(o){this.loading||!this.hasMore||(this.loading=!0,this.stockService.getStocks(this.currentPage,10,this.searchQuery).subscribe({next:e=>{this.stocks=1===this.currentPage?e.items:[...this.stocks,...e.items],this.hasMore=e.paging.currentPage<e.paging.totalPages,this.currentPage++,this.loading=!1,o&&o.target.complete()},error:e=>{console.error("Error loading stocks:",e),this.loading=!1,o&&o.target.complete()}}))}onSearchInput(o){const e=o.target.value||"";this.searchQuery=e,this.searchSubject.next(e)}performSearch(o){this.searchQuery=o,this.currentPage=1,this.hasMore=!0,this.stocks=[],this.loadStocks()}clearSearch(){this.searchQuery="",this.searchInput&&(this.searchInput.value=""),this.performSearch("")}openCreateForm(){this.selectedStock=null,this.formMode="create",this.showForm=!0}openReadForm(o){this.stockService.getStock(o.stockIdSeq).subscribe({next:e=>{this.selectedStock=e,this.formMode="read",this.showForm=!0},error:e=>{console.error("Error loading stock details:",e)}})}openUpdateForm(o){this.stockService.getStock(o.stockIdSeq).subscribe({next:e=>{this.selectedStock=e,this.formMode="update",this.showForm=!0},error:e=>{console.error("Error loading stock details:",e)}})}confirmDelete(o){var e=this;return(0,M.A)(function*(){yield(yield e.alertController.create({header:"Confirm Delete",message:`Are you sure you want to delete stock "${o.stockId}"?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>{e.deleteStock(o)}}]})).present()})()}deleteStock(o){this.stockService.deleteStock(o.stockIdSeq).subscribe({next:()=>{this.stocks=this.stocks.filter(e=>e.stockIdSeq!==o.stockIdSeq),console.log("Stock deleted successfully")},error:e=>{console.error("Error deleting stock:",e)}})}handleFormSubmit(o){"create"===this.formMode?this.stockService.createStock(o).subscribe({next:e=>{this.stocks.unshift(e),this.closeForm(),console.log("Stock created successfully")},error:e=>{console.error("Error creating stock:",e)}}):"update"===this.formMode&&this.selectedStock&&this.stockService.updateStock(this.selectedStock.stockIdSeq,o).subscribe({next:e=>{const n=this.stocks.findIndex(d=>d.stockIdSeq===this.selectedStock?.stockIdSeq);n>-1&&(this.stocks[n]=e),this.closeForm(),console.log("Stock updated successfully")},error:e=>{console.error("Error updating stock:",e)}}),this.closeForm()}closeForm(){this.showForm=!1,this.selectedStock=null,this.formMode=null}onHeaderBackClick(){console.log("Header back button clicked - navigating back"),this.operationsService.navigateToOperations()}static#t=i=()=>(this.\u0275fac=function(e){return new(e||c)(t.rXU(l.hG),t.rXU(I.q9),t.rXU($),t.rXU(O.A))},this.\u0275cmp=t.VBU({type:c,selectors:[["app-stock-management"]],viewQuery:function(e,n){if(1&e&&t.GBs(B,5),2&e){let d;t.mGM(d=t.lsd())&&(n.searchInput=d.first)}},standalone:!1,decls:20,vars:7,consts:[["searchInput",""],["backAction","back","rightIconColor","primary",3,"backClicked","rightButtonClicked","showBackButton"],[1,"page-header"],[1,"page-title-container"],[1,"page-title"],[1,"page-subtitle"],["fill","solid","color","primary",1,"add-button",3,"click"],["slot","start","name","add-outline"],[1,"search-card"],["placeholder","Search by stock ID, material, or seller...","debounce","0",3,"keyup","ionClear","value"],["class","results-info",4,"ngIf"],[4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"ionInfinite","disabled"],["loadingSpinner","bubbles","loadingText","Loading more stock..."],["isOpen","true",3,"ionModalDidDismiss",4,"ngIf"],[1,"results-info"],["class","stock-item",4,"ngFor","ngForOf"],[1,"stock-item"],[3,"click"],["color","primary"],[1,"material"],[1,"quantity"],["slot","end"],["color","secondary",3,"click"],["slot","icon-only","name","create-outline"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"],[1,"empty-state"],["isOpen","true",3,"ionModalDidDismiss"],["backAction","dismiss",3,"backClicked","title","showBackButton"]],template:function(e,n){if(1&e){const d=t.RV6();t.j41(0,"app-header",1),t.bIt("backClicked",function(){return s.eBV(d),s.Njj(n.onHeaderBackClick())})("rightButtonClicked",function(){return s.eBV(d),s.Njj(n.openCreateForm())}),t.k0s(),t.j41(1,"ion-content")(2,"div",2)(3,"div",3)(4,"h1",4),t.EFF(5,"Stock"),t.k0s(),t.j41(6,"p",5),t.EFF(7,"Manage inventory and stock levels"),t.k0s()(),t.j41(8,"ion-button",6),t.bIt("click",function(){return s.eBV(d),s.Njj(n.openCreateForm())}),t.nrm(9,"ion-icon",7),t.EFF(10," Add "),t.k0s()(),t.j41(11,"ion-card",8)(12,"ion-searchbar",9,0),t.bIt("keyup",function(u){return s.eBV(d),s.Njj(n.onSearchInput(u))})("ionClear",function(){return s.eBV(d),s.Njj(n.clearSearch())}),t.k0s()(),t.DNE(14,R,6,1,"ion-item",10)(15,T,2,1,"ion-list",11)(16,N,7,2,"ion-card",12),t.j41(17,"ion-infinite-scroll",13),t.bIt("ionInfinite",function(u){return s.eBV(d),s.Njj(n.loadStocks(u))}),t.nrm(18,"ion-infinite-scroll-content",14),t.k0s(),t.DNE(19,V,2,0,"ion-modal",15),t.k0s()}2&e&&(t.Y8G("showBackButton",!0),t.R7$(12),t.Y8G("value",n.searchQuery),t.R7$(2),t.Y8G("ngIf",n.searchQuery),t.R7$(),t.Y8G("ngIf",n.stocks.length>0),t.R7$(),t.Y8G("ngIf",0===n.stocks.length&&!n.loading),t.R7$(),t.Y8G("disabled",!n.hasMore),t.R7$(2),t.Y8G("ngIf",n.showForm))},dependencies:[g.Sq,g.bT,l.In,l.Jm,l.QW,l.b_,l.I9,l.ME,l.tN,l.W9,l.iq,l.Ax,l.Hp,l.uz,l.he,l.nf,l.S1,l.Sb,l.Gw,C.l,g.vh],styles:[".page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;background:var(--ion-color-light);border-bottom:1px solid var(--ion-color-medium)}.page-title-container[_ngcontent-%COMP%]{flex:1}.page-title[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600;color:var(--ion-color-dark)}.page-subtitle[_ngcontent-%COMP%]{margin:4px 0 0;font-size:.9rem;color:var(--ion-color-medium-shade)}.add-button[_ngcontent-%COMP%]{--border-radius: 8px;height:40px;font-weight:500}.search-card[_ngcontent-%COMP%]{margin:16px 16px 8px;border-radius:12px;box-shadow:0 2px 8px #0000001a}.search-card[_ngcontent-%COMP%]   ion-searchbar[_ngcontent-%COMP%]{--background: transparent;--border-radius: 8px;padding:4px}.results-info[_ngcontent-%COMP%]{--background: var(--ion-color-light);--color: var(--ion-color-medium-shade);font-size:.9rem;margin:0 16px 8px;border-radius:8px}.stock-item[_ngcontent-%COMP%]{margin:8px 16px;border-radius:12px;--background: var(--ion-color-light);box-shadow:0 2px 8px #00000014;--border-color: transparent}.stock-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{cursor:pointer;padding:8px 0}.stock-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin-bottom:8px;color:var(--ion-color-dark)}.stock-item[_ngcontent-%COMP%]   .material[_ngcontent-%COMP%], .stock-item[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{font-size:.9rem;color:var(--ion-color-medium-shade);margin:4px 0}.stock-item[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:.75rem;margin-left:8px}.empty-state[_ngcontent-%COMP%]{margin:32px 16px;text-align:center;border-radius:12px;box-shadow:0 2px 8px #0000001a}.empty-state[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{color:var(--ion-color-medium-shade);font-size:1.2rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:8px 0}ion-button[_ngcontent-%COMP%]{--border-radius: 8px}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:12px}.add-button[_ngcontent-%COMP%]{width:100%}}"]}))}return i(),c})(),X=(()=>{var i;class c{static#t=i=()=>(this.\u0275fac=function(e){return new(e||c)},this.\u0275mod=t.$C({type:c}),this.\u0275inj=s.G2t({providers:[l.hG],imports:[g.MD,l.bv,f.X1,C.l,f.YN,b.iI.forChild([{path:"",component:Q}])]}))}return i(),c})()}}]);