"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3317],{3317:(A,M,s)=>{s.r(M),s.d(M,{MachineManagementModule:()=>V});var u=s(2200),a=s(7343),h=s(4341),I=s(467),b=s(1413),v=s(9584),_=s(3294),S=s(6977),e=s(3664),m=s(2615),y=s(5035),F=s(9330),f=s(8810),g=s(9437),$=s(5312),j=s(8938),D=s(3067);let R=(()=>{var i;class r{constructor(n,t){this.http=n,this.loginService=t,this.API_URL=`${$.c.apiBaseUrl}/machine`}getHeaders(){const n=this.loginService.getToken();return new F.Lr({"Content-Type":"application/json",Authorization:`Bearer ${n}`})}getMachines(n=1,t=j.R.TEN,o){let l=`${this.API_URL}?page=${n}&itemsPerPage=${t}`;return o&&o.trim()&&(l+=`&search=${encodeURIComponent(o.trim())}`),this.http.get(l,{headers:this.getHeaders()}).pipe((0,g.W)(d=>(0,f.$)(()=>d)))}getMachine(n){return this.http.get(`${this.API_URL}/${n}`,{headers:this.getHeaders()}).pipe((0,g.W)(t=>(0,f.$)(()=>t)))}createMachine(n){return this.http.post(this.API_URL,n,{headers:this.getHeaders()}).pipe((0,g.W)(t=>(0,f.$)(()=>t)))}updateMachine(n,t){return this.http.put(`${this.API_URL}/${n}`,t,{headers:this.getHeaders()}).pipe((0,g.W)(o=>(0,f.$)(()=>o)))}deleteMachine(n){return this.http.delete(`${this.API_URL}/${n}`,{headers:this.getHeaders()}).pipe((0,g.W)(t=>(0,f.$)(()=>t)))}static#e=i=()=>(this.\u0275fac=function(t){return new(t||r)(m.KVO(F.Qq),m.KVO(D.H))},this.\u0275prov=m.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}))}return i(),r})();var T=s(5473),G=s(228);function B(i,r){1&i&&(e.j41(0,"ion-text",11)(1,"small"),e.EFF(2,"Machine ID is required."),e.k0s()())}function N(i,r){1&i&&(e.j41(0,"ion-text",11)(1,"small"),e.EFF(2,"Machine Name is required."),e.k0s()())}function P(i,r){1&i&&(e.j41(0,"ion-text",11)(1,"small"),e.EFF(2,"Work Type is required."),e.k0s()())}function E(i,r){if(1&i&&(e.j41(0,"ion-row")(1,"ion-col",12)(2,"ion-button",13),e.EFF(3),e.k0s()()()),2&i){const c=e.XpG();e.R7$(2),e.Y8G("disabled",c.processForm.invalid||c.isSubmitting),e.R7$(),e.SpI(" ","create"===c.mode?"Add":"Update"," ")}}let k=(()=>{var i;class r{constructor(n,t,o){this.fb=n,this.router=t,this.navCtrl=o,this.mode="create",this.formData=null,this.formSubmit=new e.bkB,this.isSubmitting=!1,this.processForm=this.fb.group({machineId:["",h.k0.required],machineName:["",h.k0.required],workType:["",h.k0.required],shortName:[""],process:[""]})}ngOnChanges(n){n.formData&&this.formData?(this.processForm.patchValue(this.formData),"read"===this.mode?this.processForm.disable():this.processForm.enable()):"create"===this.mode&&(this.processForm.reset(),this.processForm.enable())}goBack(){this.navCtrl.back()}submit(){"read"!==this.mode&&this.processForm.valid&&(this.isSubmitting=!0,this.formSubmit.emit(this.processForm.value),this.isSubmitting=!1)}static#e=i=()=>(this.\u0275fac=function(t){return new(t||r)(e.rXU(h.ok),e.rXU(G.Ix),e.rXU(y.q9))},this.\u0275cmp=e.VBU({type:r,selectors:[["app-machine-process"]],inputs:{mode:"mode",formData:"formData"},outputs:{formSubmit:"formSubmit"},features:[e.OA$],decls:29,vars:10,consts:[[1,"sme-form-card","ion-no-margin"],[3,"ngSubmit","formGroup"],["size","12"],["fill","outline",1,"ion-margin-bottom"],["type","text","formControlName","machineId","label","Machine id *","label-placement","floating",3,"readonly"],["color","danger",4,"ngIf"],["type","text","formControlName","machineName","label","Machine name *","label-placement","floating",3,"readonly"],["type","text","formControlName","workType","label","Work type *","label-placement","floating",3,"readonly"],["type","text","formControlName","shortName","label","Short name","label-placement","floating",3,"readonly"],["type","text","formControlName","process","label","Process","label-placement","floating",3,"readonly"],[4,"ngIf"],["color","danger"],["size","12",1,"ion-text-center"],["type","submit","color","primary",3,"disabled"]],template:function(t,o){if(1&t&&(e.j41(0,"ion-card",0)(1,"ion-card-content")(2,"form",1),e.bIt("ngSubmit",function(){return o.submit()}),e.j41(3,"ion-grid")(4,"ion-row")(5,"ion-col",2)(6,"ion-item",3),e.nrm(7,"ion-input",4),e.k0s(),e.DNE(8,B,3,0,"ion-text",5),e.k0s()(),e.j41(9,"ion-row")(10,"ion-col",2)(11,"ion-item",3),e.nrm(12,"ion-input",6),e.k0s(),e.DNE(13,N,3,0,"ion-text",5),e.k0s()(),e.j41(14,"ion-row")(15,"ion-col",2)(16,"ion-item",3),e.nrm(17,"ion-input",7),e.k0s(),e.DNE(18,P,3,0,"ion-text",5),e.k0s()(),e.j41(19,"ion-row")(20,"ion-col",2)(21,"ion-item",3),e.nrm(22,"ion-input",8),e.k0s()()(),e.j41(23,"ion-row")(24,"ion-col",2)(25,"ion-item",3),e.nrm(26,"ion-input",9),e.k0s()()(),e.DNE(27,E,4,2,"ion-row",10),e.k0s()()()(),e.nrm(28,"app-footer")),2&t){let l,d,p;e.R7$(2),e.Y8G("formGroup",o.processForm),e.R7$(5),e.Y8G("readonly","read"===o.mode),e.R7$(),e.Y8G("ngIf",(null==(l=o.processForm.get("machineId"))?null:l.invalid)&&((null==(l=o.processForm.get("machineId"))?null:l.touched)||(null==(l=o.processForm.get("machineId"))?null:l.dirty))&&"read"!==o.mode),e.R7$(4),e.Y8G("readonly","read"===o.mode),e.R7$(),e.Y8G("ngIf",(null==(d=o.processForm.get("machineName"))?null:d.invalid)&&((null==(d=o.processForm.get("machineName"))?null:d.touched)||(null==(d=o.processForm.get("machineName"))?null:d.dirty))&&"read"!==o.mode),e.R7$(4),e.Y8G("readonly","read"===o.mode),e.R7$(),e.Y8G("ngIf",(null==(p=o.processForm.get("workType"))?null:p.invalid)&&((null==(p=o.processForm.get("workType"))?null:p.touched)||(null==(p=o.processForm.get("workType"))?null:p.dirty))&&"read"!==o.mode),e.R7$(4),e.Y8G("readonly","read"===o.mode),e.R7$(4),e.Y8G("readonly","read"===o.mode),e.R7$(),e.Y8G("ngIf","read"!==o.mode)}},dependencies:[u.MD,u.bT,h.X1,h.qT,h.BC,h.cb,h.j4,h.JD,a.bv,a.Jm,a.b_,a.I9,a.hU,a.lO,a.$w,a.uz,a.ln,a.IO,a.Gw,T.n],styles:["ion-content[_ngcontent-%COMP%]{height:300px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{background-color:#004d99!important;color:#fff;box-shadow:0 2px 8px #0000004d}ion-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.2rem;color:#fff}ion-icon[_ngcontent-%COMP%]{color:#fff}"]}))}return i(),r})();var C=s(385);const U=["searchInput"];function x(i,r){if(1&i){const c=e.RV6();e.j41(0,"ion-item")(1,"ion-label",3),e.bIt("click",function(){const t=m.eBV(c).$implicit,o=e.XpG();return m.Njj(o.openReadForm(t))}),e.j41(2,"h2"),e.EFF(3),e.j41(4,"ion-badge",4),e.EFF(5),e.k0s()(),e.j41(6,"p",5),e.EFF(7,"Type: "),e.j41(8,"strong"),e.EFF(9),e.k0s()(),e.j41(10,"p",6),e.EFF(11),e.k0s()(),e.j41(12,"ion-buttons",7)(13,"ion-button",8),e.bIt("click",function(){const t=m.eBV(c).$implicit,o=e.XpG();return m.Njj(o.openUpdateForm(t))}),e.nrm(14,"ion-icon",9),e.k0s(),e.j41(15,"ion-button",10),e.bIt("click",function(){const t=m.eBV(c).$implicit,o=e.XpG();return m.Njj(o.confirmDelete(t))}),e.nrm(16,"ion-icon",11),e.k0s()()()}if(2&i){const c=r.$implicit;e.R7$(3),e.SpI("",c.machineName," "),e.R7$(2),e.SpI("#",c.machineId),e.R7$(4),e.JRh(c.machineType),e.R7$(2),e.Lme("Capacity: ",c.capacity," | Model: ",c.model)}}function w(i,r){if(1&i){const c=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",13)(5,"ion-button",14),e.bIt("click",function(){m.eBV(c);const t=e.XpG(2);return m.Njj(t.closeForm())}),e.nrm(6,"ion-icon",15),e.k0s()()()(),e.j41(7,"ion-content")(8,"app-machine-process",16),e.bIt("formSubmit",function(t){m.eBV(c);const o=e.XpG(2);return m.Njj(o.handleFormSubmit(t))}),e.k0s()()}if(2&i){const c=e.XpG(2);e.R7$(3),e.SpI(" ","create"===c.formMode?"Create Machine":"update"===c.formMode?"Update Machine Detail":"Machine Details"," "),e.R7$(5),e.Y8G("mode",c.formMode)("formData",c.selectedMachine)}}function O(i,r){if(1&i){const c=e.RV6();e.j41(0,"ion-modal",12),e.bIt("ionModalDidDismiss",function(){m.eBV(c);const t=e.XpG();return m.Njj(t.closeForm())}),e.DNE(1,w,9,3,"ng-template"),e.k0s()}}let X=(()=>{var i;class r{constructor(n,t,o){this.alertController=n,this.navCtrl=t,this.machineService=o,this.machines=[],this.formMode=null,this.selectedMachine=null,this.showForm=!1,this.currentPage=1,this.hasMore=!0,this.loading=!1,this.searchQuery="",this.searchSubject=new b.B,this.destroy$=new b.B,this.searchSubject.pipe((0,v.B)(300),(0,_.F)(),(0,S.Q)(this.destroy$)).subscribe(l=>{this.performSearch(l)})}ngOnInit(){console.log("Machine Management Component Initialized"),this.loadMachines()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.searchSubject.complete()}loadMachines(n){this.loading||!this.hasMore||(this.loading=!0,this.machineService.getMachines(this.currentPage,10,this.searchQuery).subscribe({next:t=>{this.machines=1===this.currentPage?t.items:[...this.machines,...t.items],this.hasMore=t.paging.currentPage<t.paging.totalPages,this.currentPage++,this.loading=!1,n&&n.target.complete()},error:t=>{console.error("Error loading machines:",t),this.loading=!1,n&&n.target.complete()}}))}onSearchInput(n){const t=n.target.value||"";this.searchQuery=t,this.searchSubject.next(t)}performSearch(n){this.searchQuery=n,this.currentPage=1,this.hasMore=!0,this.machines=[],this.loadMachines()}clearSearch(){this.searchQuery="",this.searchInput&&(this.searchInput.value=""),this.performSearch("")}openCreateForm(){this.selectedMachine=null,this.formMode="create",this.showForm=!0}openReadForm(n){this.machineService.getMachine(n.machineIdSeq).subscribe({next:t=>{this.selectedMachine=t,this.formMode="read",this.showForm=!0},error:t=>{console.error("Error loading machine details:",t)}})}openUpdateForm(n){this.machineService.getMachine(n.machineIdSeq).subscribe({next:t=>{this.selectedMachine=t,this.formMode="update",this.showForm=!0},error:t=>{console.error("Error loading machine details:",t)}})}confirmDelete(n){var t=this;return(0,I.A)(function*(){yield(yield t.alertController.create({header:"Confirm Delete",message:`Are you sure you want to delete machine "${n.machineName}"?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>{t.deleteMachine(n)}}]})).present()})()}deleteMachine(n){this.machineService.deleteMachine(n.machineIdSeq).subscribe({next:()=>{this.machines=this.machines.filter(t=>t.machineIdSeq!==n.machineIdSeq),console.log("Machine deleted successfully")},error:t=>{console.error("Error deleting machine:",t)}})}handleFormSubmit(n){"create"===this.formMode?this.machineService.createMachine(n).subscribe({next:t=>{this.machines.unshift(t),this.closeForm(),console.log("Machine created successfully")},error:t=>{console.error("Error creating machine:",t)}}):"update"===this.formMode&&this.selectedMachine&&this.machineService.updateMachine(this.selectedMachine.machineIdSeq,n).subscribe({next:t=>{const o=this.machines.findIndex(l=>l.machineIdSeq===this.selectedMachine?.machineIdSeq);o>-1&&(this.machines[o]=t),this.closeForm(),console.log("Machine updated successfully")},error:t=>{console.error("Error updating machine:",t)}}),this.closeForm()}closeForm(){this.showForm=!1,this.selectedMachine=null,this.formMode=null}onHeaderBackClick(){console.log("Header back button clicked - navigating back"),this.navCtrl.back()}static#e=i=()=>(this.\u0275fac=function(t){return new(t||r)(e.rXU(a.hG),e.rXU(y.q9),e.rXU(R))},this.\u0275cmp=e.VBU({type:r,selectors:[["app-machine-management"]],viewQuery:function(t,o){if(1&t&&e.GBs(U,5),2&t){let l;e.mGM(l=e.lsd())&&(o.searchInput=l.first)}},standalone:!1,decls:5,vars:3,consts:[["title","Machine Management","backAction","back","rightIcon","add-circle-outline","rightIconColor","primary",3,"backClicked","rightButtonClicked","showBackButton"],[4,"ngFor","ngForOf"],["isOpen","true",3,"ionModalDidDismiss",4,"ngIf"],[3,"click"],["color","primary"],[1,"type"],[1,"specs"],["slot","end"],["color","secondary",3,"click"],["slot","icon-only","name","create-outline"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"],["isOpen","true",3,"ionModalDidDismiss"],["slot","start"],["color","medium",3,"click"],["slot","icon-only","name","arrow-back-outline"],[3,"formSubmit","mode","formData"]],template:function(t,o){1&t&&(e.j41(0,"app-header",0),e.bIt("backClicked",function(){return o.onHeaderBackClick()})("rightButtonClicked",function(){return o.openCreateForm()}),e.k0s(),e.j41(1,"ion-content")(2,"ion-list"),e.DNE(3,x,17,5,"ion-item",1),e.k0s(),e.DNE(4,O,2,0,"ion-modal",2),e.k0s()),2&t&&(e.Y8G("showBackButton",!0),e.R7$(3),e.Y8G("ngForOf",o.machines),e.R7$(),e.Y8G("ngIf",o.showForm))},dependencies:[u.Sq,u.bT,a.In,a.Jm,a.QW,a.W9,a.eU,a.iq,a.uz,a.he,a.nf,a.BC,a.ai,a.Sb,k,C.l],encapsulation:2}))}return i(),r})();var Y=s(8132);let V=(()=>{var i;class r{static#e=i=()=>(this.\u0275fac=function(t){return new(t||r)},this.\u0275mod=e.$C({type:r}),this.\u0275inj=m.G2t({providers:[a.hG],imports:[u.MD,a.bv,h.X1,k,C.l,Y.iI.forChild([{path:"",component:X}])]}))}return i(),r})()}}]);